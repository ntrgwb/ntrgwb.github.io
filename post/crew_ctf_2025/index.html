<!doctype html>
<html
  lang="en" 
  data-theme-mode="auto"
  >
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/><title>
  Crew CTF 2025 | Ngo Truong
</title>
<meta
  name="description"
  content="ntrgwb "
/><script>
  window.siteConfig = JSON.parse("{\"anchor_icon\":null,\"base\":\"http://localhost:1313/\",\"clipboard\":{\"copyright\":{\"count\":50,\"enable\":false,\"license_type\":\"by-nc-sa\"},\"enable\":true,\"fail\":{\"en\":\"Copy failed (ﾟ⊿ﾟ)ﾂ\",\"ja\":\"コピー失敗 (ﾟ⊿ﾟ)ﾂ\",\"zh-cn\":\"复制失败 (ﾟ⊿ﾟ)ﾂ\",\"zh-tw\":\"複製失敗 (ﾟ⊿ﾟ)ﾂ\"},\"success\":{\"en\":\"Copy successfully (*^▽^*)\",\"ja\":\"コピー成功 (*^▽^*)\",\"zh-cn\":\"复制成功 (*^▽^*)\",\"zh-tw\":\"複製成功 (*^▽^*)\"}},\"code_block\":{\"expand\":true},\"i18n_languages\":[{\"Lang\":\"en\",\"LanguageName\":\"English\",\"LanguageCode\":\"\",\"Title\":\"\",\"LanguageDirection\":\"\",\"Weight\":1,\"Disabled\":false},{\"Lang\":\"vi\",\"LanguageName\":\"Tiếng Việt\",\"LanguageCode\":\"\",\"Title\":\"\",\"LanguageDirection\":\"\",\"Weight\":1,\"Disabled\":false}],\"icon_font\":\"4552607_0khxww3tj3q9\",\"outdate\":{\"daysago\":180,\"enable\":false,\"message\":{\"en\":\"This article was last updated on {time}. Please note that the content may no longer be applicable.\",\"ja\":\"この記事は最終更新日：{time}。記載内容が現在有効でない可能性がありますのでご注意ください。\",\"zh-cn\":\"本文最后更新于 {time}，请注意文中内容可能已不适用。\",\"zh-tw\":\"本文最後更新於 {time}，請注意文中內容可能已不適用。\"}}}");
  
</script>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  rel="preload"
  as="style"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
/>
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
  media="print"
  onload="this.media='all'"
/>
<link
    rel="preload"
    href="//at.alicdn.com/t/c/font_4552607_0khxww3tj3q9.woff2"
    as="font"
    type="font/woff2"
    crossorigin="anonymous"
  /><link rel="stylesheet" href="/css/loader.css" />
<meta property="og:type" content="website" />
  <meta property="og:title" content="Crew CTF 2025 | Ngo Truong" />
  <meta
    property="og:description"
    content="ntrgwb "
  />
  <meta property="og:url" content="http://localhost:1313/post/crew_ctf_2025/" />
  <meta
    property="og:site_name"
    content="I have not failed, I just found 10,000 ways that won&#39;t work."
  />
  <meta
    property="og:image"
    content="/images/crew.jpg.png"
  />
  <meta property="article:author" content="Ngo Truong" />
  <meta property="article:published_time" content="2025-06-25T00:00:00&#43;00:00" />
  <meta property="article:modified_time" content="2025-06-25T00:00:00&#43;00:00" /><meta property="article:tag" content="ctfweb" /><meta name="twitter:card" content="summary" />
  <meta name="twitter:image" content="/images/crew.jpg.png" />
<link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/main.css" />
<link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css"
    integrity="sha384-IfxC36XL/toUyJ939C73PcgMuRzAZuIzZxE38drsmO5p6jD7ei&#43;Zx/1oA/0l8ysE" crossorigin="anonymous"onload="this.onload=null;this.rel='stylesheet'"
  /><link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/katex@0.16.22/dist/katex.min.css"
    integrity="sha384-5TcZemv2l/9On385z///&#43;d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP" crossorigin="anonymous"onload="this.onload=null;this.rel='stylesheet'"
  /><script
    src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"
    integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"></script><link
    rel="stylesheet"
    href="https://npm.webcache.cn/@reimujs/aos@0.1.0/dist/aos.css"
    integrity="sha384-4NN3fZ5AokFyHuoihl7A9qWaCt&#43;HsAtOaUsXwJGRb4/SMBtFr2vcNSHR5E8dg0Wk" crossorigin="anonymous"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/monokai.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
</head>
  <body><div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi rotate"><svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
            <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="var(--red-1, #ff5252)" />
            <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
          M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="var(--red-1, #ff5252)" />
          </svg></div><div class="loading-word">Loading...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script><div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>
<div id="lang-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
This article does not have a corresponding language version
</div><div id="container">
      <div id="wrap"><div id="header-nav">
  <nav id="main-nav"><span class="main-nav-link-wrap">
        <div class='main-nav-icon icon rotate'>&#xe62b;</div>
        <a class="main-nav-link" href="/">Home</a>
      </span><span class="main-nav-link-wrap">
        <div class='main-nav-icon icon rotate'>&#xe62b;</div>
        <a class="main-nav-link" href="/archives">Archives</a>
      </span><span class="main-nav-link-wrap">
        <div class='main-nav-icon icon rotate'>&#xe62b;</div>
        <a class="main-nav-link" href="/about">About</a>
      </span><a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav"></nav><nav id="i18n-nav">
      <div class="custom-dropdown">
        <div class="select-selected" id="select-selected">
          <span id="nav-language-btn" class="nav-icon" style="padding: 0 20px 0 0"></span>
          <span id="selected-lang">English</span>
        </div>
        <ul class="select-items" id="select-items"><li data-value="en" class="selected" >English</li><li data-value="vi"  >Tiếng Việt</li></ul>
      </div>
      <script>
        var selectSelected = document.getElementById("select-selected");
        var selectedLang = document.getElementById("selected-lang");
        var selectItems = document.getElementById("select-items");
        var selectOptions = selectItems.querySelectorAll("li");

        selectSelected.addEventListener("click", () => {
          selectItems.classList.toggle("show");
        });

        selectOptions.forEach((item) => {
          item.addEventListener("click", () => {
            const langMap = {};selectedLang.textContent = item.textContent;
            selectItems.classList.remove("show");
            selectOptions.forEach((option) => {
              option.classList.remove("selected");
            });
            item.classList.add("selected");
            if (item.dataset.value === 'en') {
              return;
            }
            if (!langMap[item.dataset.value]) {
              _$("#lang-tooltip").style.opacity = "1";
              setTimeout(() => {
                _$("#lang-tooltip").style.opacity = "0";
              }, 1000);
              return;
            }
            window.location = langMap[item.dataset.value];
          });
        });

        document.addEventListener("click", (event) => {
          if (!event.target.closest(".custom-dropdown")) {
            selectItems.classList.remove("show");
          }
        });
      </script>
    </nav></div>
<header id="header"><picture></picture>
    <img  fetchpriority="high" src="/images/crew.jpg.png" alt="Crew CTF 2025"><div id="header-outer">
    <div id="header-title"><a href="/" id="logo">
            <h1 data-aos="slide-up">Crew CTF 2025</h1>
          </a><h2 id="subtitle-wrap" data-aos="slide-down"></h2></div>
  </div>
</header><div id="content"
          
          class="sidebar-right"  ><aside id="sidebar"><div class="sidebar-wrapper wrap-sticky">
    <div
      class="sidebar-wrap"
      data-aos="fade-up"
    ><div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#proxies">Proxies</a></li>
  </ul>
</nav>
  </div>
</div></div>
          <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img
    data-src="/avatar/meo.webp"
    data-sizes="auto"
    alt="Ngo Truong"
    class="lazyload"
  />
  <div class="sidebar-author-name">Ngo Truong</div>
  <div class="sidebar-description">ntrgwb </div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div><div class="sidebar-state-number">5</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">
      1
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">2</div>
  </div>
</div>
<div class="sidebar-social"><div class="icon-discord sidebar-social-icon">
      <a
        href="https://discord.com/channels/ntrg"
        itemprop="url"
        target="_blank"
        aria-label="discord"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div><div class="icon-github sidebar-social-icon">
      <a
        href="https://github.com/ntrg0wb"
        itemprop="url"
        target="_blank"
        aria-label="github"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div></div>
<div class="sidebar-menu"><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">Home</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">Archives</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="About"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">About</div>
    </div></div>
</div><div class="sidebar-btn-wrapper" style="position:static">
            <div class="sidebar-toc-btn current"></div>
            <div class="sidebar-common-btn"></div>
          </div></div>
  </div>

  <div class="sidebar-widget"></div></aside>
<section id="main"><article
  class="h-entry article"
  itemprop="blogPost"
  itemscope
  itemtype="https://schema.org/BlogPosting"
>
  <div
    class="article-inner"
    data-aos="fade-up"
  >
    <div class="article-meta"><div class="article-date">
  <span
    class="article-date-link"
    data-aos="zoom-in"
  >
    <time datetime="2025-06-25 00:00:00 &#43;0000 UTC" itemprop="datePublished"
      >2025-06-25</time
    >
    <time style="display: none;" id="post-update-time"
      >2025-06-25</time
    >
  </span>
</div>
<div class="article-category"><a
      class="article-category-link"
      href="/categories/writeup"
      data-aos="zoom-in"
      >WRITEUP</a
    ></div>
</div>
    <div class="hr-line"></div><div class="e-content article-entry" itemprop="articleBody"><p>Crew ctf 2025</p>
<h2 id="proxies">
<a class="header-anchor" href="#proxies"></a>
Proxies
</h2><div class="highlight"><div style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">#------------------Flag1----------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">from</span> <span style="color:#8fbcbb">flask</span> <span style="color:#81a1c1;font-weight:bold">import</span> Flask<span style="color:#eceff4">,</span> request
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#8fbcbb">os</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#8fbcbb">gzip</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#8fbcbb">zlib</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#8fbcbb">io</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#81a1c1">=</span> Flask<span style="color:#eceff4">(</span>__name__<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#d08770">@app.before_request</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> <span style="color:#88c0d0">decompress_request</span><span style="color:#eceff4">():</span>
</span></span><span style="display:flex;"><span>    encoding <span style="color:#81a1c1">=</span> request<span style="color:#81a1c1">.</span>headers<span style="color:#81a1c1">.</span>get<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Content-Encoding&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;&#34;</span><span style="color:#eceff4">)</span><span style="color:#81a1c1">.</span>lower<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> encoding <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;gzip&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;deflate&#34;</span><span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>        raw_data <span style="color:#81a1c1">=</span> request<span style="color:#81a1c1">.</span>get_data<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">try</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">if</span> encoding <span style="color:#81a1c1">==</span> <span style="color:#a3be8c">&#34;gzip&#34;</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>                data <span style="color:#81a1c1">=</span> gzip<span style="color:#81a1c1">.</span>GzipFile<span style="color:#eceff4">(</span>fileobj<span style="color:#81a1c1">=</span>io<span style="color:#81a1c1">.</span>BytesIO<span style="color:#eceff4">(</span>raw_data<span style="color:#eceff4">))</span><span style="color:#81a1c1">.</span>read<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">elif</span> encoding <span style="color:#81a1c1">==</span> <span style="color:#a3be8c">&#34;deflate&#34;</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#81a1c1;font-weight:bold">try</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>                    data <span style="color:#81a1c1">=</span> zlib<span style="color:#81a1c1">.</span>decompress<span style="color:#eceff4">(</span>raw_data<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#81a1c1;font-weight:bold">except</span> zlib<span style="color:#81a1c1">.</span>error<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>                    data <span style="color:#81a1c1">=</span> zlib<span style="color:#81a1c1">.</span>decompress<span style="color:#eceff4">(</span>raw_data<span style="color:#eceff4">,</span> <span style="color:#81a1c1">-</span>zlib<span style="color:#81a1c1">.</span>MAX_WBITS<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>            request<span style="color:#81a1c1">.</span>_cached_data <span style="color:#81a1c1">=</span> data
</span></span><span style="display:flex;"><span>            request<span style="color:#81a1c1">.</span>environ<span style="color:#eceff4">[</span><span style="color:#a3be8c">&#34;wsgi.input&#34;</span><span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> io<span style="color:#81a1c1">.</span>BytesIO<span style="color:#eceff4">(</span>data<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>            request<span style="color:#81a1c1">.</span>content_length <span style="color:#81a1c1">=</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>data<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">except</span> <span style="color:#bf616a">Exception</span> <span style="color:#81a1c1;font-weight:bold">as</span> e<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#a3be8c">f</span><span style="color:#a3be8c">&#34;Failed to decompress request body: </span><span style="color:#a3be8c">{</span>e<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">400</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#d08770">@app.route</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;/&lt;path:path&gt;&#34;</span><span style="color:#eceff4">,</span> methods<span style="color:#81a1c1">=</span><span style="color:#eceff4">[</span><span style="color:#a3be8c">&#34;GET&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;POST&#34;</span><span style="color:#eceff4">])</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> <span style="color:#88c0d0">hello</span><span style="color:#eceff4">(</span>path<span style="color:#eceff4">):</span>        
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> request<span style="color:#81a1c1">.</span>method <span style="color:#81a1c1">==</span> <span style="color:#a3be8c">&#34;POST&#34;</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>        message <span style="color:#81a1c1">=</span> request<span style="color:#81a1c1">.</span>data
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">f</span><span style="color:#a3be8c">&#34;Received message: </span><span style="color:#a3be8c">{</span>message<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span><span style="color:#eceff4">,</span> flush<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">True</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#a3be8c">b</span><span style="color:#a3be8c">&#34;GIVE ME FLAG!&#34;</span> <span style="color:#81a1c1;font-weight:bold">in</span> message<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#a3be8c">&#34;OK HERE IS YOUR FLAG: &#34;</span> <span style="color:#81a1c1">+</span> os<span style="color:#81a1c1">.</span>getenv<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;FLAG1&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;Fake flag 1&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#a3be8c">&#34;Hello from User!&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">if</span> __name__ <span style="color:#81a1c1">==</span> <span style="color:#a3be8c">&#34;__main__&#34;</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>    app<span style="color:#81a1c1">.</span>run<span style="color:#eceff4">(</span>host<span style="color:#81a1c1">=</span><span style="color:#a3be8c">&#34;0.0.0.0&#34;</span><span style="color:#eceff4">,</span> port<span style="color:#81a1c1">=</span><span style="color:#81a1c1">int</span><span style="color:#eceff4">(</span>os<span style="color:#81a1c1">.</span>getenv<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;USER_PORT&#34;</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">1337</span><span style="color:#eceff4">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Ở flag1 handler nhận 1 POST và request.data chứa chính xác chuỗi bytes b&quot;GIVE ME FLAG!&quot; thì ta sẽ nhận được flag1</p>
</li>
<li>
<p>Vậy nếu ta gửi request như sau</p>
</li>
<li>
<p><img src="/images/crew1.png" alt="Alt text"></p>
</li>
<li>
<p>Ta chỉ nhận lại được Hello from user!</p>
</li>
</ul>
<div class="highlight"><div style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">216
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">package</span> handler
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#eceff4">(</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;bytes&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;io&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;log/slog&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;math/rand/v2&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;net&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;github.com/tunneling/pkg/listener&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;github.com/tunneling/pkg/protocol&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;github.com/tunneling/pkg/util&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;gvisor.dev/gvisor/pkg/tcpip&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;gvisor.dev/gvisor/pkg/tcpip/adapters/gonet&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;gvisor.dev/gvisor/pkg/tcpip/network/ipv4&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;gvisor.dev/gvisor/pkg/tcpip/stack&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;gvisor.dev/gvisor/pkg/tcpip/transport/tcp&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;gvisor.dev/gvisor/pkg/waiter&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">const</span> TCP_RCV_BUFF_SIZE <span style="color:#eceff4">=</span> <span style="color:#b48ead">0</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">const</span> MAX_IN_FLIGHT_CONN_ATTEMPTS <span style="color:#eceff4">=</span> <span style="color:#b48ead">1024</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">TCPHandler</span><span style="color:#eceff4">(</span>ustack <span style="color:#81a1c1">*</span>stack<span style="color:#eceff4">.</span>Stack<span style="color:#eceff4">,</span> nicID tcpip<span style="color:#eceff4">.</span>NICID<span style="color:#eceff4">,</span> procCtx context<span style="color:#eceff4">.</span>Context<span style="color:#eceff4">,</span> clientName <span style="color:#81a1c1">string</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">*</span>tcp<span style="color:#eceff4">.</span>Forwarder<span style="color:#eceff4">,</span> <span style="color:#81a1c1">error</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	tcpForwarder <span style="color:#81a1c1">:=</span> tcp<span style="color:#eceff4">.</span><span style="color:#88c0d0">NewForwarder</span><span style="color:#eceff4">(</span>ustack<span style="color:#eceff4">,</span> TCP_RCV_BUFF_SIZE<span style="color:#eceff4">,</span> MAX_IN_FLIGHT_CONN_ATTEMPTS<span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">func</span><span style="color:#eceff4">(</span>req <span style="color:#81a1c1">*</span>tcp<span style="color:#eceff4">.</span>ForwarderRequest<span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		reqID <span style="color:#81a1c1">:=</span> req<span style="color:#eceff4">.</span><span style="color:#88c0d0">ID</span><span style="color:#eceff4">()</span> 
</span></span><span style="display:flex;"><span>		slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Info</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;TCP forward request:&#34;</span><span style="color:#eceff4">,</span> slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">String</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;from&#34;</span><span style="color:#eceff4">,</span> util<span style="color:#eceff4">.</span><span style="color:#88c0d0">FromNetstackIP</span><span style="color:#eceff4">(</span>reqID<span style="color:#eceff4">.</span>RemoteAddress<span style="color:#eceff4">).</span><span style="color:#88c0d0">String</span><span style="color:#eceff4">()),</span> slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">String</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;to&#34;</span><span style="color:#eceff4">,</span> util<span style="color:#eceff4">.</span><span style="color:#88c0d0">FromNetstackIP</span><span style="color:#eceff4">(</span>reqID<span style="color:#eceff4">.</span>LocalAddress<span style="color:#eceff4">).</span><span style="color:#88c0d0">String</span><span style="color:#eceff4">()))</span>
</span></span><span style="display:flex;"><span>		dstIP <span style="color:#81a1c1">:=</span> reqID<span style="color:#eceff4">.</span>LocalAddress
</span></span><span style="display:flex;"><span>		pa <span style="color:#81a1c1">:=</span> tcpip<span style="color:#eceff4">.</span>ProtocolAddress<span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			AddressWithPrefix<span style="color:#eceff4">:</span> dstIP<span style="color:#eceff4">.</span><span style="color:#88c0d0">WithPrefix</span><span style="color:#eceff4">(),</span>
</span></span><span style="display:flex;"><span>			Protocol<span style="color:#eceff4">:</span>          ipv4<span style="color:#eceff4">.</span>ProtocolNumber<span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		ustack<span style="color:#eceff4">.</span><span style="color:#88c0d0">AddProtocolAddress</span><span style="color:#eceff4">(</span>nicID<span style="color:#eceff4">,</span> pa<span style="color:#eceff4">,</span> stack<span style="color:#eceff4">.</span>AddressProperties<span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			PEB<span style="color:#eceff4">:</span>        stack<span style="color:#eceff4">.</span>CanBePrimaryEndpoint<span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>			ConfigType<span style="color:#eceff4">:</span> stack<span style="color:#eceff4">.</span>AddressConfigStatic<span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		agent <span style="color:#81a1c1">:=</span> listener<span style="color:#eceff4">.</span><span style="color:#88c0d0">GetClient</span><span style="color:#eceff4">(</span>clientName<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">if</span> agent <span style="color:#81a1c1">==</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Error</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Client is down&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;client&#34;</span><span style="color:#eceff4">,</span> clientName<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			req<span style="color:#eceff4">.</span><span style="color:#88c0d0">Complete</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">true</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">:=</span> protocol<span style="color:#eceff4">.</span><span style="color:#88c0d0">SendConnectRequest</span><span style="color:#eceff4">(</span>agent<span style="color:#eceff4">.</span>Conn<span style="color:#eceff4">,</span> <span style="color:#eceff4">[]</span><span style="color:#81a1c1">byte</span><span style="color:#eceff4">{</span><span style="color:#b48ead">127</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">},</span> reqID<span style="color:#eceff4">.</span>LocalPort<span style="color:#eceff4">,</span> rand<span style="color:#eceff4">.</span><span style="color:#88c0d0">Uint32</span><span style="color:#eceff4">());</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Error</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Cannot send SYN request&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;err&#34;</span><span style="color:#eceff4">,</span> err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			req<span style="color:#eceff4">.</span><span style="color:#88c0d0">Complete</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">true</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">var</span> agentConnID <span style="color:#81a1c1">uint32</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">select</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">case</span> synResponse <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">&lt;-</span>agent<span style="color:#eceff4">.</span>ConnRespChan<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">if</span> synResponse<span style="color:#eceff4">.</span>Ok <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>				agentConnID <span style="color:#eceff4">=</span> synResponse<span style="color:#eceff4">.</span>ID
</span></span><span style="display:flex;"><span>				slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Info</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Got connection from agent&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;ID&#34;</span><span style="color:#eceff4">,</span> agentConnID<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#eceff4">}</span> <span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>				slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Warn</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Agent refused connection&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>				req<span style="color:#eceff4">.</span><span style="color:#88c0d0">Complete</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">true</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>				<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>			<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">case</span> <span style="color:#81a1c1">&lt;-</span>time<span style="color:#eceff4">.</span><span style="color:#88c0d0">After</span><span style="color:#eceff4">(</span><span style="color:#b48ead">5</span> <span style="color:#81a1c1">*</span> time<span style="color:#eceff4">.</span>Second<span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>			slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Error</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Timeout waiting for ConnectResponse&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			req<span style="color:#eceff4">.</span><span style="color:#88c0d0">Complete</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">true</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">var</span> wq waiter<span style="color:#eceff4">.</span>Queue
</span></span><span style="display:flex;"><span>		endpoint<span style="color:#eceff4">,</span> err <span style="color:#81a1c1">:=</span> req<span style="color:#eceff4">.</span><span style="color:#88c0d0">CreateEndpoint</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">&amp;</span>wq<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Error</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Failed to create endpoint&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;err&#34;</span><span style="color:#eceff4">,</span> err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			req<span style="color:#eceff4">.</span><span style="color:#88c0d0">Complete</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">true</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>		req<span style="color:#eceff4">.</span><span style="color:#88c0d0">Complete</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">true</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		endpoint<span style="color:#eceff4">.</span><span style="color:#88c0d0">SocketOptions</span><span style="color:#eceff4">().</span><span style="color:#88c0d0">SetKeepAlive</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">true</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		client <span style="color:#81a1c1">:=</span> gonet<span style="color:#eceff4">.</span><span style="color:#88c0d0">NewTCPConn</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">&amp;</span>wq<span style="color:#eceff4">,</span> endpoint<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">defer</span> client<span style="color:#eceff4">.</span><span style="color:#88c0d0">Close</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>		_<span style="color:#eceff4">,</span> cancel <span style="color:#81a1c1">:=</span> context<span style="color:#eceff4">.</span><span style="color:#88c0d0">WithCancel</span><span style="color:#eceff4">(</span>procCtx<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">defer</span> <span style="color:#88c0d0">cancel</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		waitEntry<span style="color:#eceff4">,</span> notifyCh <span style="color:#81a1c1">:=</span> waiter<span style="color:#eceff4">.</span><span style="color:#88c0d0">NewChannelEntry</span><span style="color:#eceff4">(</span>waiter<span style="color:#eceff4">.</span>EventHUp<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		wq<span style="color:#eceff4">.</span><span style="color:#88c0d0">EventRegister</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">&amp;</span>waitEntry<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">defer</span> wq<span style="color:#eceff4">.</span><span style="color:#88c0d0">EventUnregister</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">&amp;</span>waitEntry<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		done <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">chan</span> <span style="color:#81a1c1">bool</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">defer</span> <span style="color:#81a1c1">close</span><span style="color:#eceff4">(</span>done<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">go</span> <span style="color:#81a1c1;font-weight:bold">func</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">select</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">case</span> <span style="color:#81a1c1">&lt;-</span>notifyCh<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>				slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Info</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Netstack forwardTCP notified, canceling context&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">case</span> <span style="color:#81a1c1">&lt;-</span>done<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>			<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#88c0d0">cancel</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}()</span>
</span></span><span style="display:flex;"><span>		<span style="color:#88c0d0">handleClient</span><span style="color:#eceff4">(</span>client<span style="color:#eceff4">,</span> agent<span style="color:#eceff4">,</span> agentConnID<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">})</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span> tcpForwarder<span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">handleClient</span><span style="color:#eceff4">(</span>client net<span style="color:#eceff4">.</span>Conn<span style="color:#eceff4">,</span> agent <span style="color:#81a1c1">*</span>listener<span style="color:#eceff4">.</span>AgentConn<span style="color:#eceff4">,</span> agentConnID <span style="color:#81a1c1">uint32</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">defer</span> client<span style="color:#eceff4">.</span><span style="color:#88c0d0">Close</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	dataCh <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">chan</span> <span style="color:#81a1c1">*</span>protocol<span style="color:#eceff4">.</span>DataPacket<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	closeCh <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">chan</span> <span style="color:#81a1c1">*</span>protocol<span style="color:#eceff4">.</span>CloseRequest<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	agent<span style="color:#eceff4">.</span>Mu<span style="color:#eceff4">.</span><span style="color:#88c0d0">Lock</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>	agent<span style="color:#eceff4">.</span>DataChans<span style="color:#eceff4">[</span>agentConnID<span style="color:#eceff4">]</span> <span style="color:#eceff4">=</span> dataCh
</span></span><span style="display:flex;"><span>	agent<span style="color:#eceff4">.</span>CloseChans<span style="color:#eceff4">[</span>agentConnID<span style="color:#eceff4">]</span> <span style="color:#eceff4">=</span> closeCh
</span></span><span style="display:flex;"><span>	agent<span style="color:#eceff4">.</span>Mu<span style="color:#eceff4">.</span><span style="color:#88c0d0">Unlock</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">defer</span> <span style="color:#81a1c1;font-weight:bold">func</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		agent<span style="color:#eceff4">.</span>Mu<span style="color:#eceff4">.</span><span style="color:#88c0d0">Lock</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1">delete</span><span style="color:#eceff4">(</span>agent<span style="color:#eceff4">.</span>DataChans<span style="color:#eceff4">,</span> agentConnID<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1">delete</span><span style="color:#eceff4">(</span>agent<span style="color:#eceff4">.</span>CloseChans<span style="color:#eceff4">,</span> agentConnID<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		agent<span style="color:#eceff4">.</span>Mu<span style="color:#eceff4">.</span><span style="color:#88c0d0">Unlock</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	buf <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">([]</span><span style="color:#81a1c1">byte</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">32</span><span style="color:#81a1c1">*</span><span style="color:#b48ead">1024</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	clientToAgent <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">chan</span> <span style="color:#81a1c1">error</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	agentToClient <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">chan</span> <span style="color:#81a1c1">error</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// go func() {</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 	for {</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 		n, err := client.Read(buf)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 		if err != nil {</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 			if err == io.EOF {</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 				slog.Info(&#34;Client EOF -&gt; CloseRequest&#34;)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 				_ = protocol.SendCloseRequest(agent.Conn, agentConnID)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 			}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 			clientToAgent &lt;- err</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 			return</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 		}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 		data := buf[:n]</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 		// Check if &#34;chunked&#34; or &#34;gzip&#34; or &#34;flag&#34; in data</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 		slog.Debug(&#34;Client -&gt; Agent: &#34;, slog.String(&#34;data&#34;, string(data)))</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 		_ = protocol.SendDataPacket(agent.Conn, agentConnID, data)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// 	}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// }()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">go</span> <span style="color:#81a1c1;font-weight:bold">func</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			n<span style="color:#eceff4">,</span> err <span style="color:#81a1c1">:=</span> client<span style="color:#eceff4">.</span><span style="color:#88c0d0">Read</span><span style="color:#eceff4">(</span>buf<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">==</span> io<span style="color:#eceff4">.</span>EOF <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>					slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Info</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Client EOF -&gt; CloseRequest&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>					_ <span style="color:#eceff4">=</span> protocol<span style="color:#eceff4">.</span><span style="color:#88c0d0">SendCloseRequest</span><span style="color:#eceff4">(</span>agent<span style="color:#eceff4">.</span>Conn<span style="color:#eceff4">,</span> agentConnID<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>				<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>				clientToAgent <span style="color:#81a1c1">&lt;-</span> err
</span></span><span style="display:flex;"><span>				<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>			<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			data <span style="color:#81a1c1">:=</span> buf<span style="color:#eceff4">[:</span>n<span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			keywords <span style="color:#81a1c1">:=</span> <span style="color:#eceff4">[][]</span><span style="color:#81a1c1">byte</span><span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#eceff4">[]</span><span style="color:#81a1c1">byte</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;chunked&#34;</span><span style="color:#eceff4">),</span>
</span></span><span style="display:flex;"><span>				<span style="color:#eceff4">[]</span><span style="color:#81a1c1">byte</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;json&#34;</span><span style="color:#eceff4">),</span>
</span></span><span style="display:flex;"><span>				<span style="color:#eceff4">[]</span><span style="color:#81a1c1">byte</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;urlencoded&#34;</span><span style="color:#eceff4">),</span>
</span></span><span style="display:flex;"><span>				<span style="color:#eceff4">[]</span><span style="color:#81a1c1">byte</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;give me flag!&#34;</span><span style="color:#eceff4">),</span>
</span></span><span style="display:flex;"><span>			<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">for</span> _<span style="color:#eceff4">,</span> kw <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1;font-weight:bold">range</span> keywords <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>				lowerData <span style="color:#81a1c1">:=</span> bytes<span style="color:#eceff4">.</span><span style="color:#88c0d0">ToLower</span><span style="color:#eceff4">(</span>data<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>				lowerKw <span style="color:#81a1c1">:=</span> bytes<span style="color:#eceff4">.</span><span style="color:#88c0d0">ToLower</span><span style="color:#eceff4">(</span>kw<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>				searchIdx <span style="color:#81a1c1">:=</span> <span style="color:#b48ead">0</span>
</span></span><span style="display:flex;"><span>				<span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>					idx <span style="color:#81a1c1">:=</span> bytes<span style="color:#eceff4">.</span><span style="color:#88c0d0">Index</span><span style="color:#eceff4">(</span>lowerData<span style="color:#eceff4">[</span>searchIdx<span style="color:#eceff4">:],</span> lowerKw<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>					<span style="color:#81a1c1;font-weight:bold">if</span> idx <span style="color:#81a1c1">==</span> <span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>						<span style="color:#81a1c1;font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>					<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>					idx <span style="color:#81a1c1">+=</span> searchIdx
</span></span><span style="display:flex;"><span>					replacement <span style="color:#81a1c1">:=</span> <span style="color:#eceff4">[]</span><span style="color:#81a1c1">byte</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;REDACTED&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>					<span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>replacement<span style="color:#eceff4">)</span> <span style="color:#eceff4">&gt;</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>kw<span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>						replacement <span style="color:#eceff4">=</span> replacement<span style="color:#eceff4">[:</span><span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>kw<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>					<span style="color:#eceff4">}</span> <span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>replacement<span style="color:#eceff4">)</span> <span style="color:#eceff4">&lt;</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>kw<span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>						padding <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">([]</span><span style="color:#81a1c1">byte</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>kw<span style="color:#eceff4">)</span><span style="color:#81a1c1">-</span><span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>replacement<span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>						<span style="color:#81a1c1;font-weight:bold">for</span> i <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1;font-weight:bold">range</span> padding <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>							padding<span style="color:#eceff4">[</span>i<span style="color:#eceff4">]</span> <span style="color:#eceff4">=</span> <span style="color:#a3be8c">&#39; &#39;</span>
</span></span><span style="display:flex;"><span>						<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>						replacement <span style="color:#eceff4">=</span> <span style="color:#81a1c1">append</span><span style="color:#eceff4">(</span>replacement<span style="color:#eceff4">,</span> padding<span style="color:#81a1c1">...</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>					<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>					<span style="color:#81a1c1">copy</span><span style="color:#eceff4">(</span>data<span style="color:#eceff4">[</span>idx<span style="color:#eceff4">:</span>idx<span style="color:#81a1c1">+</span><span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>kw<span style="color:#eceff4">)],</span> replacement<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>					searchIdx <span style="color:#eceff4">=</span> idx <span style="color:#81a1c1">+</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>kw<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>				<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>			slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Debug</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Client -&gt; Agent&#34;</span><span style="color:#eceff4">,</span> slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">String</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;data&#34;</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1">string</span><span style="color:#eceff4">(</span>data<span style="color:#eceff4">)))</span>
</span></span><span style="display:flex;"><span>			_ <span style="color:#eceff4">=</span> protocol<span style="color:#eceff4">.</span><span style="color:#88c0d0">SendDataPacket</span><span style="color:#eceff4">(</span>agent<span style="color:#eceff4">.</span>Conn<span style="color:#eceff4">,</span> agentConnID<span style="color:#eceff4">,</span> data<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">go</span> <span style="color:#81a1c1;font-weight:bold">func</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">select</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">case</span> pkt <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">&lt;-</span>dataCh<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>				slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Debug</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Agent -&gt; Client: &#34;</span><span style="color:#eceff4">,</span> slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">String</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;data&#34;</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1">string</span><span style="color:#eceff4">(</span>pkt<span style="color:#eceff4">.</span>Data<span style="color:#eceff4">)))</span>
</span></span><span style="display:flex;"><span>				<span style="color:#81a1c1;font-weight:bold">if</span> _<span style="color:#eceff4">,</span> err <span style="color:#81a1c1">:=</span> client<span style="color:#eceff4">.</span><span style="color:#88c0d0">Write</span><span style="color:#eceff4">(</span>pkt<span style="color:#eceff4">.</span>Data<span style="color:#eceff4">);</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>					agentToClient <span style="color:#81a1c1">&lt;-</span> err
</span></span><span style="display:flex;"><span>					<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>				<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">case</span> <span style="color:#81a1c1">&lt;-</span>closeCh<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>				slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Info</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Got CloseRequest from agent&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>				agentToClient <span style="color:#81a1c1">&lt;-</span> io<span style="color:#eceff4">.</span>EOF
</span></span><span style="display:flex;"><span>				<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>			<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">select</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">case</span> err <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">&lt;-</span>clientToAgent<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>		slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Info</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Client -&gt; Agent closed&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;err&#34;</span><span style="color:#eceff4">,</span> err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">case</span> err <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">&lt;-</span>agentToClient<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>		slog<span style="color:#eceff4">.</span><span style="color:#88c0d0">Info</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Agent -&gt; Client closed&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;err&#34;</span><span style="color:#eceff4">,</span> err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Nguyên nhân là do trước khi gửi req Proxy ở giữa nhận raw TCP/HTTP bytes, trong file tunnel/handler/tcp.go có đoạn</p>
</li>
<li>
<p><code>lowerData := bytes.ToLower(data)</code> , tìm các keywords có &ldquo;give me flag!&rdquo; và thay chúng bằng REDACTED</p>
</li>
<li>
<p>Nên data đã được sửa trước khi gửi req</p>
</li>
<li>
<p>Ta tận dụng middleware decompress_request()</p>
</li>
<li>
<p>How to confirm?</p>
</li>
<li>
<p>Ta tiến hành gửi gzip pyload với header Content-Encoding: gzip để có thể tận dụng được hàm decompress_request, proxy không tìm được chuỗi trong raw gzip byte -&gt; forward nguyên gzip</p>
</li>
<li>
<p>Sau khi bypass được proxy @app.before_request tiến hành giải nén trước khi gửi request</p>
</li>
<li>
<p><img src="/images/crew2.png" alt="Alt text"></p>
</li>
</ul>
<div class="highlight"><div style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">#-----------------------------Flag2-------------------------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">from</span> <span style="color:#8fbcbb">flask</span> <span style="color:#81a1c1;font-weight:bold">import</span> Flask
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#8fbcbb">os</span>
</span></span><span style="display:flex;"><span>app <span style="color:#81a1c1">=</span> Flask<span style="color:#eceff4">(</span>__name__<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#d08770">@app.route</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;/admin&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> <span style="color:#88c0d0">hello</span><span style="color:#eceff4">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#a3be8c">&#34;I am admin, here is your flag: &#34;</span> <span style="color:#81a1c1">+</span> os<span style="color:#81a1c1">.</span>getenv<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;FLAG2&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;Fake flag 2&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">if</span> __name__ <span style="color:#81a1c1">==</span> <span style="color:#a3be8c">&#34;__main__&#34;</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>    app<span style="color:#81a1c1">.</span>run<span style="color:#eceff4">(</span>host<span style="color:#81a1c1">=</span><span style="color:#a3be8c">&#34;0.0.0.0&#34;</span><span style="color:#eceff4">,</span> port<span style="color:#81a1c1">=</span><span style="color:#81a1c1">int</span><span style="color:#eceff4">(</span>os<span style="color:#81a1c1">.</span>getenv<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;ADMIN_PORT&#34;</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">3000</span><span style="color:#eceff4">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">52
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">from</span> <span style="color:#8fbcbb">flask</span> <span style="color:#81a1c1;font-weight:bold">import</span> Flask<span style="color:#eceff4">,</span> request<span style="color:#eceff4">,</span> Response
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#8fbcbb">requests</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#8fbcbb">os</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#81a1c1">=</span> Flask<span style="color:#eceff4">(</span>__name__<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TARGET_HOST <span style="color:#81a1c1">=</span> <span style="color:#a3be8c">&#34;10.0.0.5&#34;</span>
</span></span><span style="display:flex;"><span>TARGET_PORT <span style="color:#81a1c1">=</span> <span style="color:#81a1c1">int</span><span style="color:#eceff4">(</span>os<span style="color:#81a1c1">.</span>getenv<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;USER_PORT&#34;</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">1337</span><span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>ADMIN_PORT <span style="color:#81a1c1">=</span> <span style="color:#81a1c1">int</span><span style="color:#eceff4">(</span>os<span style="color:#81a1c1">.</span>getenv<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;ADMIN_PORT&#34;</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">3000</span><span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#d08770">@app.route</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;/admin_check&#34;</span><span style="color:#eceff4">,</span> methods<span style="color:#81a1c1">=</span><span style="color:#eceff4">[</span><span style="color:#a3be8c">&#34;GET&#34;</span><span style="color:#eceff4">])</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> <span style="color:#88c0d0">admin_check</span><span style="color:#eceff4">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">try</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>        resp <span style="color:#81a1c1">=</span> requests<span style="color:#81a1c1">.</span>get<span style="color:#eceff4">(</span><span style="color:#a3be8c">f</span><span style="color:#a3be8c">&#34;http://</span><span style="color:#a3be8c">{</span>TARGET_HOST<span style="color:#a3be8c">}</span><span style="color:#a3be8c">:</span><span style="color:#a3be8c">{</span>ADMIN_PORT<span style="color:#a3be8c">}</span><span style="color:#a3be8c">/admin&#34;</span><span style="color:#eceff4">,</span> timeout<span style="color:#81a1c1">=</span><span style="color:#b48ead">3</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#a3be8c">&#34;I am admin&#34;</span> <span style="color:#81a1c1;font-weight:bold">in</span> resp<span style="color:#81a1c1">.</span>text<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#a3be8c">&#34;OK&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#a3be8c">&#34;Forbidden&#34;</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">403</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">except</span> requests<span style="color:#81a1c1">.</span>RequestException<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#a3be8c">&#34;Error contacting admin service&#34;</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">500</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#d08770">@app.route</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;/&#34;</span><span style="color:#eceff4">,</span> methods<span style="color:#81a1c1">=</span><span style="color:#eceff4">[</span><span style="color:#a3be8c">&#34;GET&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;POST&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;PUT&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;DELETE&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;PATCH&#34;</span><span style="color:#eceff4">])</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> <span style="color:#88c0d0">home</span><span style="color:#eceff4">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#a3be8c">&#34;Welcome to the Proxy Service!&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#d08770">@app.route</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;/&lt;path:path&gt;&#34;</span><span style="color:#eceff4">,</span> methods<span style="color:#81a1c1">=</span><span style="color:#eceff4">[</span><span style="color:#a3be8c">&#34;GET&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;POST&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;PUT&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;DELETE&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;PATCH&#34;</span><span style="color:#eceff4">])</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> <span style="color:#88c0d0">proxy</span><span style="color:#eceff4">(</span>path<span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">try</span><span style="color:#eceff4">:</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#616e87;font-style:italic"># Build target URL</span>
</span></span><span style="display:flex;"><span>        target_url <span style="color:#81a1c1">=</span> <span style="color:#a3be8c">f</span><span style="color:#a3be8c">&#34;http://</span><span style="color:#a3be8c">{</span>TARGET_HOST<span style="color:#a3be8c">}</span><span style="color:#a3be8c">:</span><span style="color:#a3be8c">{</span>TARGET_PORT<span style="color:#a3be8c">}</span><span style="color:#a3be8c">/</span><span style="color:#a3be8c">{</span>path<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#616e87;font-style:italic"># Forward request method, headers, and body</span>
</span></span><span style="display:flex;"><span>        resp <span style="color:#81a1c1">=</span> requests<span style="color:#81a1c1">.</span>request<span style="color:#eceff4">(</span>
</span></span><span style="display:flex;"><span>            method<span style="color:#81a1c1">=</span>request<span style="color:#81a1c1">.</span>method<span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>            url<span style="color:#81a1c1">=</span>target_url<span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>            headers<span style="color:#81a1c1">=</span><span style="color:#eceff4">{</span>key<span style="color:#eceff4">:</span> value <span style="color:#81a1c1;font-weight:bold">for</span> key<span style="color:#eceff4">,</span> value <span style="color:#81a1c1;font-weight:bold">in</span> request<span style="color:#81a1c1">.</span>headers <span style="color:#81a1c1;font-weight:bold">if</span> key<span style="color:#81a1c1">.</span>lower<span style="color:#eceff4">()</span> <span style="color:#81a1c1">!=</span> <span style="color:#a3be8c">&#34;host&#34;</span><span style="color:#eceff4">},</span>
</span></span><span style="display:flex;"><span>            data<span style="color:#81a1c1">=</span>request<span style="color:#81a1c1">.</span>get_data<span style="color:#eceff4">(),</span>
</span></span><span style="display:flex;"><span>            cookies<span style="color:#81a1c1">=</span>request<span style="color:#81a1c1">.</span>cookies<span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>            allow_redirects<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#616e87;font-style:italic"># Return response with original status code and headers</span>
</span></span><span style="display:flex;"><span>        excluded_headers <span style="color:#81a1c1">=</span> <span style="color:#eceff4">{</span><span style="color:#a3be8c">&#34;content-encoding&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;content-length&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;transfer-encoding&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;connection&#34;</span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>        headers <span style="color:#81a1c1">=</span> <span style="color:#eceff4">[(</span>name<span style="color:#eceff4">,</span> value<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">for</span> name<span style="color:#eceff4">,</span> value <span style="color:#81a1c1;font-weight:bold">in</span> resp<span style="color:#81a1c1">.</span>raw<span style="color:#81a1c1">.</span>headers<span style="color:#81a1c1">.</span>items<span style="color:#eceff4">()</span> <span style="color:#81a1c1;font-weight:bold">if</span> name<span style="color:#81a1c1">.</span>lower<span style="color:#eceff4">()</span> <span style="color:#81a1c1;font-weight:bold">not</span> <span style="color:#81a1c1;font-weight:bold">in</span> excluded_headers<span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">return</span> Response<span style="color:#eceff4">(</span>resp<span style="color:#81a1c1">.</span>content<span style="color:#eceff4">,</span> resp<span style="color:#81a1c1">.</span>status_code<span style="color:#eceff4">,</span> headers<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">except</span> <span style="color:#bf616a">Exception</span> <span style="color:#81a1c1;font-weight:bold">as</span> e<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">return</span> Response<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Something went wrong&#34;</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">500</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">if</span> __name__ <span style="color:#81a1c1">==</span> <span style="color:#a3be8c">&#34;__main__&#34;</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>    app<span style="color:#81a1c1">.</span>run<span style="color:#eceff4">(</span>host<span style="color:#81a1c1">=</span><span style="color:#a3be8c">&#34;0.0.0.0&#34;</span><span style="color:#eceff4">,</span> port<span style="color:#81a1c1">=</span><span style="color:#b48ead">8000</span><span style="color:#eceff4">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Router /admin không được public ra ngoài mà chúng ta chỉ có thể gọi /check_admin</p>
</li>
<li>
<p>Chúng ta chỉ có thể giao tiếp với proxy_service.py nó sẽ chuyển yêu cầu của chúng ta đến url đã được hardcoded <code>http://{TARGET_HOST}:{ADMIN_PORT}/admin</code></p>
</li>
<li>
<p>Go Tunnel: Để kết nối giữa Flask và service nội bộ, hệ thống dùng một tunnel viết bằng Go. Cơ chế của tunnel này là multiplexing – nó ghép nhiều kết nối TCP qua một kênh duy nhất giữa agent và proxy. Thông điệp khởi tạo (ConnectRequest) không gắn chặt với ID gốc mà agent tự tạo agentConnID mới, sau đó mọi gói tin đi qua đều chỉ dùng chung một ConnRespChan</p>
</li>
<li>
<p>Bug: Do tunnel không gắn kết đúng request–response mà chỉ lấy phản hồi đầu tiên từ kênh chung, hai kết nối đồng thời có thể bị tráo map với nhau. Nghĩa là byte stream từ kết nối A (ví dụ /admin_check) có thể đi lạc sang kết nối B (ví dụ /admin).</p>
</li>
<li>
<p>Khai thác: Bằng cách gửi nhiều request đồng thời (race), ta có thể làm cho phản hồi của /admin được forward nhầm sang client gọi /admin_check. Nhờ vậy mà dữ liệu đáng lẽ chỉ nội bộ mới thấy (flag) bị lộ ra ngoài.</p>
</li>
</ul>
<div class="highlight"><div style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6c6f74">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#8fbcbb">threading</span><span style="color:#81a1c1">,</span> <span style="color:#8fbcbb">time</span><span style="color:#81a1c1">,</span> <span style="color:#8fbcbb">requests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"># TARGET_ADMIN_CHECK = &#34;http://localhost:8000/admin_check&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"># TARGET_ADMIN = &#34;http://localhost:8000/admin&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TARGET_ADMIN_CHECK <span style="color:#81a1c1">=</span> <span style="color:#a3be8c">&#34;https://inst-1c2b737912497831-proxies.chal.crewc.tf/admin_check&#34;</span>
</span></span><span style="display:flex;"><span>TARGET_ADMIN <span style="color:#81a1c1">=</span> <span style="color:#a3be8c">&#34;https://inst-1c2b737912497831-proxies.chal.crewc.tf/admin&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stop <span style="color:#81a1c1">=</span> threading<span style="color:#81a1c1">.</span>Event<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> <span style="color:#88c0d0">request1_worker</span><span style="color:#eceff4">(</span>i<span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>    s <span style="color:#81a1c1">=</span> requests<span style="color:#81a1c1">.</span>Session<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">while</span> <span style="color:#81a1c1;font-weight:bold">not</span> stop<span style="color:#81a1c1">.</span>is_set<span style="color:#eceff4">():</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">try</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>            r <span style="color:#81a1c1">=</span> s<span style="color:#81a1c1">.</span>get<span style="color:#eceff4">(</span>TARGET_ADMIN_CHECK<span style="color:#eceff4">,</span> timeout<span style="color:#81a1c1">=</span><span style="color:#b48ead">3</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>            text <span style="color:#81a1c1">=</span> r<span style="color:#81a1c1">.</span>text <span style="color:#81a1c1;font-weight:bold">or</span> <span style="color:#a3be8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#a3be8c">&#34;i am admin&#34;</span> <span style="color:#81a1c1;font-weight:bold">in</span> text<span style="color:#81a1c1">.</span>lower<span style="color:#eceff4">():</span>
</span></span><span style="display:flex;"><span>                <span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[request1] interesting:&#34;</span><span style="color:#eceff4">,</span> r<span style="color:#81a1c1">.</span>status_code<span style="color:#eceff4">,</span> text<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">except</span> <span style="color:#bf616a">Exception</span> <span style="color:#81a1c1;font-weight:bold">as</span> e<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>        time<span style="color:#81a1c1">.</span>sleep<span style="color:#eceff4">(</span><span style="color:#b48ead">0.05</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> <span style="color:#88c0d0">request2_worker</span><span style="color:#eceff4">(</span>i<span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>    s <span style="color:#81a1c1">=</span> requests<span style="color:#81a1c1">.</span>Session<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">while</span> <span style="color:#81a1c1;font-weight:bold">not</span> stop<span style="color:#81a1c1">.</span>is_set<span style="color:#eceff4">():</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">try</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>            r <span style="color:#81a1c1">=</span> s<span style="color:#81a1c1">.</span>get<span style="color:#eceff4">(</span>TARGET_ADMIN<span style="color:#eceff4">,</span> timeout<span style="color:#81a1c1">=</span><span style="color:#b48ead">3</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>            text <span style="color:#81a1c1">=</span> r<span style="color:#81a1c1">.</span>text <span style="color:#81a1c1;font-weight:bold">or</span> <span style="color:#a3be8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#a3be8c">&#34;i am admin&#34;</span> <span style="color:#81a1c1;font-weight:bold">in</span> text<span style="color:#81a1c1">.</span>lower<span style="color:#eceff4">():</span>
</span></span><span style="display:flex;"><span>                <span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[request2] interesting:&#34;</span><span style="color:#eceff4">,</span> r<span style="color:#81a1c1">.</span>status_code<span style="color:#eceff4">,</span> text<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">except</span> <span style="color:#bf616a">Exception</span> <span style="color:#81a1c1;font-weight:bold">as</span> e<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>        time<span style="color:#81a1c1">.</span>sleep<span style="color:#eceff4">(</span><span style="color:#b48ead">0.05</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"># start threads</span>
</span></span><span style="display:flex;"><span>threads <span style="color:#81a1c1">=</span> <span style="color:#eceff4">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">for</span> i <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span><span style="color:#b48ead">20</span><span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>    t1 <span style="color:#81a1c1">=</span> threading<span style="color:#81a1c1">.</span>Thread<span style="color:#eceff4">(</span>target<span style="color:#81a1c1">=</span>request1_worker<span style="color:#eceff4">,</span> args<span style="color:#81a1c1">=</span><span style="color:#eceff4">(</span>i<span style="color:#eceff4">,),</span> daemon<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">True</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    t2 <span style="color:#81a1c1">=</span> threading<span style="color:#81a1c1">.</span>Thread<span style="color:#eceff4">(</span>target<span style="color:#81a1c1">=</span>request2_worker<span style="color:#eceff4">,</span> args<span style="color:#81a1c1">=</span><span style="color:#eceff4">(</span>i<span style="color:#eceff4">,),</span> daemon<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">True</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    t1<span style="color:#81a1c1">.</span>start<span style="color:#eceff4">();</span> t2<span style="color:#81a1c1">.</span>start<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>    threads<span style="color:#81a1c1">.</span>extend<span style="color:#eceff4">([</span>t1<span style="color:#eceff4">,</span>t2<span style="color:#eceff4">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">try</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">while</span> <span style="color:#81a1c1;font-weight:bold">not</span> stop<span style="color:#81a1c1">.</span>is_set<span style="color:#eceff4">():</span>
</span></span><span style="display:flex;"><span>        time<span style="color:#81a1c1">.</span>sleep<span style="color:#eceff4">(</span><span style="color:#b48ead">0.5</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">except</span> <span style="color:#bf616a">KeyboardInterrupt</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>    stop<span style="color:#81a1c1">.</span>set<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Stopping...&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">for</span> t <span style="color:#81a1c1;font-weight:bold">in</span> threads<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>    t<span style="color:#81a1c1">.</span>join<span style="color:#eceff4">(</span>timeout<span style="color:#81a1c1">=</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Done&#34;</span><span style="color:#eceff4">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
    <footer class="article-footer"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/ctf"
        rel="tag"
        >CTF</a
      >
    </li><li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/web"
        rel="tag"
        >WEB</a
      >
    </li></ul>
</footer>
  </div><nav
    id="article-nav"
    data-aos="fade-up"
  ><div class="article-nav-link-wrap article-nav-link-left"><img
            data-src="/images/cover.jpg"
            data-sizes="auto"
            alt="Google CTF 2025"
            class="lazyload"
          /><a href="/post/google_ctf/"></a>
        <div class="article-nav-caption">Newer</div>
        <h3 class="article-nav-title">Google CTF 2025</h3>
      </div><div class="article-nav-link-wrap article-nav-link-right"><img
            data-src="/images/uss.png"
            data-sizes="auto"
            alt="HCMUS CTF 2025"
            class="lazyload"
          /><a href="/post/hcmus_ctf_2025/"></a>
        <div class="article-nav-caption">Older</div>
        <h3 class="article-nav-title">HCMUS CTF 2025</h3>
      </div></nav></article></section>
        </div><footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info"><div>
      <span class="icon-copyright"></span>2025<span class="footer-info-sep rotate"></span>
      Ngo Truong
    </div><div>
        Powered by&nbsp;<a
          >ntrg0wb</a>
      </div><div>
        <span class="icon-brush"
          >&nbsp;8.1k</span
        >
        &nbsp;|&nbsp;
        <span class="icon-coffee">&nbsp;00:41</span>
      </div><div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv"
          >Number of visits&nbsp;<span
            id="busuanzi_value_site_pv"
          ></span
        ></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv"
          >Number of visitors&nbsp;<span
            id="busuanzi_value_site_uv"
          ></span
        ></span>
      </div></div>
</footer>
<div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div><div id="mask" class="hide"></div>
      </div><nav id="mobile-nav">
  <div class="sidebar-wrap"><div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#proxies">Proxies</a></li>
  </ul>
</nav>
  </div>
</div></div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img
    data-src="/avatar/meo.webp"
    data-sizes="auto"
    alt="Ngo Truong"
    class="lazyload"
  />
  <div class="sidebar-author-name">Ngo Truong</div>
  <div class="sidebar-description">ntrgwb </div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div><div class="sidebar-state-number">5</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">
      1
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">2</div>
  </div>
</div>
<div class="sidebar-social"><div class="icon-discord sidebar-social-icon">
      <a
        href="https://discord.com/channels/ntrg"
        itemprop="url"
        target="_blank"
        aria-label="discord"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div><div class="icon-github sidebar-social-icon">
      <a
        href="https://github.com/ntrg0wb"
        itemprop="url"
        target="_blank"
        aria-label="github"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div></div>
<div class="sidebar-menu"><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">Home</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">Archives</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="About"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">About</div>
    </div></div>
</div></div><div class="sidebar-btn-wrapper">
        <div class="sidebar-toc-btn current"></div>
        <div class="sidebar-common-btn"></div>
      </div></nav>
</div><script
    src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"
    integrity="sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf&#43;e" crossorigin="anonymous"></script><script
    src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"
    integrity="sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"></script><script src="/js/main.js" ></script><script src="/js/aos.js" ></script><script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", aosInit);
    } else {
      aosInit();
    }
  </script><script src="/js/pjax_main.js" data-pjax></script><script
    src="https://npm.webcache.cn/mouse-firework@0.1.1/dist/index.umd.js"
    integrity="sha384-8LyaidD9GPxQQgLJO/WRw/O2h3BoNq/ApI/ecpvM6RsrCz2qP2ppBXUKihP4V/2d" crossorigin="anonymous"></script><script>
  if (window.firework) {
    const options = JSON.parse("{\"excludeelements\":[\"a\",\"button\"],\"particles\":[{\"colors\":[\"var(--red-1)\",\"var(--red-2)\",\"var(--red-3)\",\"var(--red-4)\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"emit\"],\"number\":20,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.3,0.5],\"radius\":[16,32]}},{\"colors\":[\"var(--red-0)\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"diffuse\"],\"number\":1,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.2,0.5],\"lineWidth\":6,\"radius\":20}}]}");
    options.excludeElements = options.excludeelements;
    delete options.excludeelements;
    window.firework(options);
  }
</script>

<div id="lazy-script">
  <div><script data-pjax>
        window.REIMU_POST = {
          author: "Ngo Truong",
          title: "Crew CTF 2025",
          url: "http:\/\/localhost:1313\/post\/crew_ctf_2025\/",
          description: "Crew ctf 2025\n",
          cover: "http:\/\/localhost:1313\/images\/crew.jpg.png",
        };
      </script><script src="/js/insert_highlight.js" data-pjax></script><script type="module" data-pjax>const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")}).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")}).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script></div>
</div><script
    src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js"
    asyncintegrity="sha384-0M75wtSkhjIInv4coYlaJU83&#43;OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id&#43;S" crossorigin="anonymous"></script><script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then((registrations) => {
        for (let registration of registrations) {
          registration.unregister();
        }
      });
    }
  </script><script>
  const reimuCopyright = String.raw`
   ______     ______     __     __    __     __  __    
  /\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
  \ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
   \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
    \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                    
  `;
  console.log(String.raw`%c ${reimuCopyright}`, "color: #ff5252;");
  console.log(
    "%c Theme.Reimu" + " %c https://github.com/D-Sketon/hugo-theme-reimu ",
    "color: white; background: #ff5252; padding:5px 0;",
    "padding:4px;border:1px solid #ff5252;",
  );
</script></body>
</html>
